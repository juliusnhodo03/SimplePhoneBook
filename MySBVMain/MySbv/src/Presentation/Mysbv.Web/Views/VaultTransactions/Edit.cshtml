 
@{
	ViewBag.Title = "Edit Vault Transactions";
}
<link href="http://cdn.kendostatic.com/2014.2.903/styles/kendo.common.min.css" rel="stylesheet" />
<link href="http://cdn.kendostatic.com/2014.2.903/styles/kendo.default.min.css" rel="stylesheet" />
<link href="http://cdn.kendostatic.com/2014.2.903/styles/kendo.dataviz.min.css" rel="stylesheet" />
<link href="http://cdn.kendostatic.com/2014.2.903/styles/kendo.dataviz.default.min.css" rel="stylesheet" />

<script src="~/Scripts/App/Controllers/FailedRequestController.js"></script>

<script>	
	var model = @ViewBag.Model
</script>

<form name="failed_transactions_form" ng-app="MySbvApp" ng-controller="FailedRequestController" novalidate ng-submit="updateRequest(model)">
	<div class="well">
	
		<div class="ui-widget-header">
			<h4 style="margin-left: 5px">Error Message</h4>
		</div>

		<div class="ui-widget-content" style="padding: 5px;">
			<!-- Non Editable Panel-->
            <div class="row">
                <div class="span11">
                    <ul>
                        <li ng-repeat="listItem in model.ErrorMessages" ><b>{{$index + 1}} - {{listItem}}</b></li>
                    </ul>
                </div>
            </div>

		</div>

		<div class="ui-widget-header">
			<h4 style="margin-left: 5px">Failed Transaction Information</h4>
		</div>
		
		<div class="ui-widget-content" style="padding: 5px;">
			<!-- Non Editable Panel-->
			<div class="row">
				<div class="span2">
					@Html.Label("lblTotalValue", "Total Value", new { @class = "label required", style = "width:150px" })
				</div>
				<div class="span2">
					@Html.TextBox("TotalValue", "", new { disabled = "disabled", data_ng_model = "model.RequestMessage.Currencies.Denominations.TotalValue" })
				</div>
				<div class="span2 offset2">

				</div>
				<div class="span2"></div>
			</div>
			
			<!-- Update Panel-->

			<div class="row">
				<div class="span2">
					@Html.Label("lblCurrencyCode", "Currency Code", new { @class = "label required", style = "width:150px" })
				</div>
				<div class="span2">
					<select style="width:245px"
							ng-disabled="!model.HasErrorOnCurrencyCode || model.IsPending"
							ng-model="model.RequestMessage.Currencies.Denominations.CurrencyCode"
							ng-options="code for code in model.Currencies"></select>
				</div>
				<div class="span2 offset2">
					<span class="label required" style="width:150px">Device Serial Number</span>
				</div>
				<div class="span2">
					<input type="text"
						   ng-disabled="!model.HasErrorOnDeviceSerialNumber || model.IsPending"
						   name="DeviceSerial"
						   data-ng-model="model.RequestMessage.DeviceSerial"
						   required>

					<small class="error"
					       ng-show="failed_transactions_form.DeviceSerial.$error.required">
						Device Serial is required.
					</small>
				</div>
			</div>

			<div class="row">
				<div class="span2">
					@Html.Label("lblTransactionDate", "Transaction Date", new { @class = "label required", style = "width:150px" })
				</div>
				<div class="span2">
					<input type="text" parsedate="yyyy-MM-dd HH:mm:ss"
						   name="TransactionDate"
						   ng-disabled="!model.HasErrorOnTransactionDate || model.IsPending"
						   ng-model="model.RequestMessage.TransactionDate"
						   kendo-date-time-picker="dateOptions"
						   k-options="dateOptions"
						   required />
					<br/>

					<small class="error" ng-show="failed_transactions_form.transactionDate.$error.required">
						Enter Transaction Date.
					</small>
				</div>
				<div class="span2 offset2">
					@Html.Label("lblTransactionType", "Transaction Type", 
					new { @class = "label required", style = "width:150px" })
				</div>
				<div class="span2">
					<select style="width:245px"
							@*ng-disabled="!model.HasErrorOnTransactionType || model.IsPending"*@
							ng-disabled="true"
							ng-model="model.SelectedVaultTransactionType"
							ng-options="description for description in model.VaultTransactionTypes"></select>
				</div>
			</div>

			<div class="row">
				<div class="span2">
					<span class="label required" style="width:150px">Beneficiary Code</span>
				</div>
				<div class="span3">
					
					<input type="text"
						   ng-disabled="!model.HasErrorOnBeneficiaryCode || model.IsPending"
						   name="BeneficiaryCode"
						   data-ng-model="model.RequestMessage.BeneficiaryCode"
						   ng-required="isBeneficiaryCodeRequired()">

					<small class="error" ng-show="failed_transactions_form.BeneficiaryCode.$error.required && model.HasErrorOnBeneficiaryCode">
						Beneficiary Code is required.
					</small>
				</div>

				<div class="span1 offset1">
					<span class="label required" style="width:150px">Cit Code</span>
				</div>
				<div class="span2 offset1">
					
					<input type="text"
						   ng-disabled="!model.HasErrorOnCitCode || model.IsPending"
						   name="CitCode"
						   data-ng-model="model.RequestMessage.CitCode"
						   required>

					<small class="error" ng-show="failed_transactions_form.CitCode.$error.required">
						Cit Code is required.
					</small>
				</div>
			</div>

			<div class="row" ng-repeat="bag in model.RequestMessage.CollectionUnits.CollectionUnit">
				<div>
					<div class="span2">
						<span class="label required" style="width:150px !important">Bag serial number {{$index + 1}}</span>
					</div>
					<div class="span3">
						<input type="text" name="bagserial"
							   ng-disabled="!model.HasErrorOnBagSerialNumber || model.IsPending"
						       data-ng-model="bag.Value"
							   ng-pattern="/^[0-9]{14,14}$/"
							   required />
						<br />
						<small class="error" ng-show="failed_transactions_form.bagserial.$error.required">
							Bag serial number  is required.
						</small>
						<small class="error" ng-show="failed_transactions_form.bagserial.$error.pattern">
							enter a number 14 characters long.
						</small>
					</div>
					<div class="span2 offset1">
						<span class="label required" style="width:150px !important">User Reference</span>
					</div>
					<div class="span2">
						<input type="text"
							   ng-disabled="!model.HasErrorOnUserReferance || model.IsPending"
							   name="UserReferance"
							   data-ng-model="model.RequestMessage.UserReferance"
							   required>

						<small class="error" ng-show="failed_transactions_form.UserReferance.$error.required">
							User Referance  is required.
						</small>
					</div>
				</div>
			</div>
		</div>
		
		<div class="ui-widget-header">
			<h4 style="margin-left: 5px">Denominations Breakdown</h4>
		</div>
		
		<div class="ui-widget-content" style="padding: 5px;">
			<table>
				<tr>
					<!-- Fit Denominations-->
					<td>
						<div class="row">
							<div class="span2">
								@Html.Label("lblTotalFitValue", "Total", new { @class = "label required", style = "width:150px" })
							</div>
							<div class="span2">
								@Html.TextBox("TotalFitValue", "", new { disabled = "disabled", data_ng_model = "model.RequestMessage.Currencies.Denominations.Fit.Value" })
							</div>
						</div>
						<div ng-repeat="item in model.RequestMessage.Currencies.Denominations.Fit.Denomination">
							<div class="row">
								<div class="span2">
									<span class="label required" style="width:150px">{{denominationResolver(item.Value)}}</span>
								</div>
								<div class="span2">
									@Html.TextBox("Denomination", "", new { disabled = "disabled", data_ng_model = "item.Count" })
								</div>
							</div>
						</div>
					</td>
					<td></td>
				</tr>
			</table>
		</div>

		

		<!-- Update Buttons -->
		<p class="row">
			<div class="span11 rightAlign">
				
				<button type="submit"
				        ng-hide="showApprover()"
				        ng-disabled="isloading"
				        class="btn btn-success"
				        style="width:100px;">Update
				</button>

				<input type="button"
					   ng-show="showApprover()"
					   ng-disabled="isloading"
					   ng-click="approveRequest(model)"
					   class="btn btn-success"
					   style="width:100px"
					   value="Approve" />

				@*<input type="button"
					   ng-show="showApprover()"
					   ng-disabled="isloading"
					   ng-click="declineRequest(model)"
					   class="btn btn-success"
					   style="width:100px"
					   value="Decline" />*@

				<input type="button" class="btn btn-danger" value="Exit" ng-click="Exit(model.IndexUrl)" style="width:80px" />
			</div>
		</p>
	</div>

	<!-- Pop up Windows-->
	<script id="MessageWindow" type="text/x-kendo-template">
		<div style="margin-left:20px;">
			<span class="headerTitle" />
			<img src="@Url.Content("~/Content/Images/infoimg.jpg")" class="imager" style="float:left" />
			<br />
			<p style="margin-left:15px;" class="confirmation-message" />
		</div>
		<div style="margin-left:160px; margin-top:15px;">
			<button id="btnConfirmCancel" class="confirm-cancel k-button" style="width:80px">Close</button>
		</div>
	</script>

	<script id="ConfirmWindow" type="text/x-kendo-template">
		<div style="margin-left:20px;">
			<span class="headerTitle" />
			<img src="@Url.Content("~/Content/Images/question.png")" style="float:left" />
			<br />
			<p style="margin-left:15px;" class="confirmation-message"></p>
		</div>
		<div style="margin-left:160px; margin-top:5px;">
			<button id="btnConfirmCancel" class="confirm-cancel k-button" style="width:80px">Yes</button>
			<button id="btnNoCancel" class="no-cancel k-button" style="width:80px">No</button>
		</div>
	</script>
</form>

<script>
	//$("#transactionDate").datetimepicker({ dateFormat: 'yyyy/MM/dd HH:mm:ss' });

	//$('#transactionDate').datetimepicker({
	//	addSliderAccess: true,
	//	sliderAccessArgs: { touchonly: false }
	//});

	$('#transactionDate').datepicker({
		numberOfMonths: 2,
		minDate: 0,
		maxDate: 30
	});
</script>